@model IEnumerable<WebCosmeticsStore.Models.Product>
@using System.Security.Claims;
@inject ApplicationDbContext context;
@{
    ViewData["Title"] = "Index";
    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier);
}
<div id="carouselExampleIndicators" class="carousel slide">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 4"></button>
    </div>
    <div class="carousel-inner mb-4">
        <div class="carousel-item active">
            <img src="~/images/banner1.png" class="d-block w-100" alt="...">
        </div>
        <div class="carousel-item">
            <img src="~/images/banner2.png" class="d-block w-100" alt="...">
        </div>
        <div class="carousel-item">
            <img src="~/images/banner3.png" class="d-block w-100" alt="...">
        </div>
        <div class="carousel-item">
            <img src="~/images/banner4.png" class="d-block w-100" alt="...">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>
<div class="d-flex justify-content-end mb-3">
    <form asp-action="Sort" class="mr-2 d-flex" method="post" style="margin-bottom: 0;">
        <select id="sortBy" name="sortBy" class="form-control rounded-pill mr-2" style="width: 200px; margin-right:20px;" onchange="this.form.submit()">
            <option>Sắp xếp</option>
            <option value="PriceDesc">Giá từ cao xuống thấp</option>
            <option value="PriceAsc">Giá từ thấp lên cao</option>
            <option value="NameAsc">Tên (A-Z)</option>
            <option value="NameDesc">Tên (Z-A)</option>
        </select>
    </form>
    <form asp-action="Search" class="mr-2 d-flex" method="post" style="margin-bottom: 0;">
        <input id="searchTerm" name="searchTerm" class="form-control rounded-pill mr-2" style="width: 200px; margin-right:20px;">
        <button type="submit" class="btn btn-lg"><i class="bi bi-search-heart"></i></button>
    </form>
</div>
<div class="row pd-3">
    @foreach (var item in Model)
    {
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="col-12 p-1" style="border:1px solid #008cba; border-radius:5px;">
                <div class="card" style="min-height:445px;">
                    @if (item.Images != null && item.Images.Any())
                    {
                        @*  <img src="~/images/@item.Images.First().Url" alt="Product Image" style="max-width: 100%; max-height: 300pxpx;" /> *@
                        <img src="~/images/@item.ImageUrl" alt="Product Image" style="max-width: 100%; max-height: 300px;" />
                    }
                    else
                    {
                        <p>No image available</p>
                    }
                    <div class="card-body d-flex flex-column">
                        <p class=" card-title h5 single-line font-weight-bold" style="font-size: 18px; min-height:43px; ">@item.Name</p>
                        <p style="color: rgba(238, 77, 45); line-height: 1.25rem; font-size: 18px; font-weight: 500;">Giá: @item.Price VNĐ</p>
                        <div class="d-flex" style="margin-bottom: 0;">
                            <span class="bi bi-star-fill fs-6 me-1 text-warning"></span>
                            <span class="bi bi-star-fill fs-6 me-1 text-warning"></span>
                            <span class="bi bi-star-fill fs-6 me-1 text-warning"></span>
                            <span class="bi bi-star-fill fs-6 me-1 text-warning"></span>
                            <span class="bi bi-star-fill fs-6 text-warning"></span>
                            <p style="color: rgba(0, 0, 0, .54118); margin-left: auto; ">Đã bán 1,2k</p>
                        </div>
                        <form method="post" asp-action="ToggleLike">
                            <input type="hidden" name="productId" value="@item.ProductId" />
                            @if (context.ProductLike.FirstOrDefault(i => i.UserId == userId && i.ProductId == item.ProductId) == null)
                            {
                                <button type="submit" class="border-0 bg-white"><i class="bi bi-hand-thumbs-up-fill fs-3 text-primary"></i></button>
                            }
                            else
                            {
                                <button type="submit" class="border-0 bg-white"><i class="bi bi-hand-thumbs-up-fill fs-3 text-dark"></i></button>
                            }
                        </form>
                    </div>
                </div>
                <div>
                    <a asp-controller="Home" asp-action="Detail" class="btn btn-success form mt-1 w-100" asp-route-productId="@item.ProductId">Detail</a>
                </div>
            </div>
        </div>
    }
</div>
